

## ğŸ”‘ 2. JWT (JSON Web Tokens) Essentials

---

### ğŸ“¦ What is JWT?

**JWT (JSON Web Token)** is a **compact**, **URL-safe**, and **digitally signed** token format used to securely transmit information between parties.

- It is **stateless** â€” the token contains all the data needed to verify identity.
- Commonly used in **token-based authentication** and **authorization**.

---

### ğŸ§¬ JWT Structure

A JWT has **three parts**, separated by dots:

```bash
xxxxx.yyyyy.zzzzz
|     |     |
|     |     â””â”€â”€ Signature (verifies authenticity)
|     â””â”€â”€ Payload (claims/data)
â””â”€â”€ Header (algorithm & token type)
```

#### 1. **Header**

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

#### 2. **Payload**

Contains **claims** â€“ pieces of information (user ID, roles, expiration):

```json
{
  "sub": "user_123",
  "email": "user@example.com",
  "role": "admin",
  "exp": 1722105600
}
```

#### 3. **Signature**

A hashed value (e.g., HMAC SHA256) of the header and payload, signed with a secret key.

```bash
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)
```

---

### ğŸ” Access Tokens vs Refresh Tokens

| Token Type        | Purpose                    | Storage              | Expiry                 |
| ----------------- | -------------------------- | -------------------- | ---------------------- |
| **Access Token**  | Authenticates API requests | Memory / Header      | Short-lived (15mâ€“1h)   |
| **Refresh Token** | Issues new access tokens   | HttpOnly Cookie / DB | Long-lived (7â€“30 days) |

- Access tokens are used frequently and should be short-lived for security.
- Refresh tokens are used sparingly to obtain new access tokens, often stored securely (e.g., HttpOnly cookie or DB).

---

### â³ JWT Expiration Strategies

#### âœ… Common Claims

- `exp` â€“ Expiration time (Unix timestamp)
- `iat` â€“ Issued at
- `nbf` â€“ Not before (optional)

#### ğŸ”„ Expiry Patterns:

1. **Short access token + long refresh token** (recommended)
2. **No refresh token â€” force re-login on expiration**
3. **Rolling refresh** â€“ refresh token expiry extends after each use

> ğŸ’¡ Pro tip: Never trust an expired JWT. Always validate the `exp` claim.

---

### âš ï¸ Risks and Best Practices

| Risk                       | Mitigation                                               |
| -------------------------- | -------------------------------------------------------- |
| âŒ Token theft (e.g., XSS) | âœ… Store token in HttpOnly cookie, not localStorage      |
| âŒ Token replay            | âœ… Use short expiries and rotate refresh tokens          |
| âŒ No server revocation    | âœ… Use a blacklist or token version field in DB          |
| âŒ Overstuffed payload     | âœ… Keep payload minimal (no sensitive data)              |
| âŒ Algorithm confusion     | âœ… Always specify strong algorithms (e.g., HS256, RS256) |

---

### âœ… Summary

- JWTs are self-contained and secure **if used properly**.
- Split concerns: **access token for auth**, **refresh token for renewal**.
- Watch out for **XSS**, **replay attacks**, and **overexposed payloads**.

